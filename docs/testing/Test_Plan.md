# Test Plan — Futures Arbitrage Radar (FAR)

Версия: 1.0  
Дата: YYYY-MM-DD  
Ответственный: команда FAR (работа в парах, индивидуальные задания)

## 1. Введение (Introduction)
Цель тестирования — подтвердить соответствие FAR (веб-приложение: FastAPI backend + React frontend) функциональным и нефункциональным требованиям из SRS: корректная агрегация биржевых данных, расчёт спредов/матриц, работа избранного, стабильность WebSocket, удобство и производительность UI.

## 2. Объект тестирования (Test Items)
**Компоненты:**
- **Backend (FastAPI)**: `app.py` (REST/WS), `exchanges.py` (адаптеры бирж/агрегация), `.env` параметры.
- **Frontend (React + Vite + TS)**: страницы `TokensPage`, `SpreadsPage`, `MatrixPage`, `FavoritesPage`; хуки `useBooks.ts`, `useFavorites.ts`; модуль `ws.ts`.
- **Интеграции**: подключение к источникам котировок (эмулируемые/боевые), WebSocket поток `/ws?exchange=...`.

**Атрибуты качества (из SRS и общие):**
- Функциональная корректность (расчёты спреда, фильтры, избранное).
- Надёжность/восстановление (автореконнект WS, устойчивость к ошибочным данным).
- Производительность (время загрузки UI, задержка обновлений).
- Юзабилити (понятная навигация, статусы).
- Безопасность (отсутствие секретов в клиенте, базовая валидация входных данных).

## 3. Риски (Risk Issues)
- Непредсказуемость внешних источников (rate-limits, 429/5xx, задержки).
- Потеря WS-соединения/фрагментация сообщений.
- Расхождения точности формул спреда при округлениях.
- Ограничения производительности на слабых машинах.
- Нестрогие схемы данных от разных бирж.
- Человеческий фактор при ручном тестировании.

## 4. Аспекты тестирования (Features to be Tested)
*(согласованы с преподавателем)*
1. Отображение списка инструментов (Tokens) и базовых метрик.
2. Расчёт и отображение **Spreads** (порог, сортировка/фильтрация).
3. **Matrix**: корректная матрица спредов между биржами/парами.
4. **Favorites**: добавление/удаление, сохранение состояния.
5. **WebSocket поток**: подключение, пинг/пונג, автореконнект, инкрементальные апдейты.
6. **REST** эндпоинты (если есть): доступность, коды, схема ответа.
7. Обработка ошибок (нет сети, пустые данные, 5xx).
8. Нефункциональные: производительность, стабильность, безопасность базового уровня, кросс-браузерность.

## 5. Подход к тестированию (Test Approach)
**Уровни:**
- Unit (формулы спреда, парсинг сообщений, утилиты).
- Integration (WS → состояние фронта; REST → отображение UI).
- System/E2E (основные пользовательские сценарии через браузер).

**Инструменты:**
- Backend: `pytest`, `pytest-asyncio`, `httpx` для REST, `websockets`/`starlette.testclient`.
- Frontend: `Vitest`/`Jest` + React Testing Library.
- E2E: `Playwright`.
- Линт/качество: `ESLint`, `tsc`.
- Производительность: `Lighthouse` (UI), `autocannon`/`k6` (опционально).
- Отчётность: этот `Test_Results.md`.

**Окружения/профили:**
- **Local Dev**: `npm run dev` / `uvicorn app:app --reload`.
- **Local Prod**: `npm run build && npm run preview`, `uvicorn app:app`.
- Браузеры: Chrome (stable), Firefox (latest).  
- ОС: Windows 10/11 (обяз.), macOS (при наличии).

## 6. Представление результатов (Pass/Fail Criteria)
**Критерии приёмки:**
- Не менее **95%** тест-кейсов со статусом Pass; 0 критических (Critical) дефектов открыто.
- Начальная загрузка UI (локальный prod build) ≤ **2.0 сек** на странице Tokens.
- Подключение к WS и получение первого снапшота ≤ **2 сек**; восстановление после обрыва ≤ **5 сек**.
- Частота пингов соблюдается, утечек памяти в браузере не обнаружено (наблюдение 10 мин).
- Расхождение расчёта спреда с эталонной формулой ≤ **1 единицы младшего разряда** отображаемой точности.

**Метрики:**
- Coverage unit ≥ 60% (логика расчётов и парсинга).
- Время TTFB REST ≤ 300 мс (локально), WS latency (среднее межсообщение) ≤ 150 мс (эмуляция).
- Кол-во дефектов по приоритетам (Critical/High/Medium/Low).

**Формат отчёта:** `docs/testing/Test_Results.md` (таблицы: тест-кейсы, дефекты, резюме).

## 7. Оценка реализации требований

**Функциональные требования:**
- Все основные функции, указанные в SRS, реализованы и покрыты тестами (см. карту требований).  
- WS и REST эндпоинты соответствуют спецификации, форматы сообщений проверены.  
- Реализованы базовые сценарии пользовательского взаимодействия (Use Case тестирование).

**Нефункциональные требования:**
- Производительность соответствует критериям приёмки (см. Pass/Fail Criteria).  
- Система устойчива при потере соединения, ошибки корректно обрабатываются.  
- Интерфейс протестирован на удобство и стабильность.

**Use Case тестирование:**  
Проверены ключевые пользовательские сценарии из SRS — подключение к бирже, просмотр спредов, добавление в избранное, обновление данных в реальном времени.


## 8. Выводы (Conclusion)
По итогам выполнения тест-кейсов и проверки нефункциональных критериев будет сформирован вывод о соответствии продукта атрибутам качества из SRS (функциональность, производительность, стабильность, UX). При невыполнении критериев приёмки — перечень обязательных исправлений и повторное тестирование.

---

## Приложение A. Карта требований SRS → тест-кейсы
| Требование SRS | Покрывающий тест-кейс |
| --- | --- |
| Отображение списка инструментов | TC-TOK-01, TC-TOK-02 |
| Расчёт спредов и сортировка | TC-SPR-01…04 |
| Матрица спредов | TC-MAT-01…03 |
| Избранное (CRUD) | TC-FAV-01…04 |
| WS стабильность/автореконнект | TC-WS-01…05 |
| Обработка ошибок/нет сети | TC-ERR-01…03 |
| Производительность UI | TC-PERF-01…02 |

## Приложение B. Тест-кейсы (кратко)
> Полные описания и фактические результаты — в `Test_Results.md`.

### Tokens
- **TC-TOK-01**: Загрузка TokensPage → виден список символов, столбцы заполнены.  
- **TC-TOK-02**: Поиск/фильтр по символу → список фильтруется корректно (позитивный/негативный запрос).  

### Spreads
- **TC-SPR-01**: Отображение таблицы спредов, значения рассчитываются по формуле из SRS.  
- **TC-SPR-02**: Сортировка по убыванию спреда.  
- **TC-SPR-03 (neg)**: Нулевые/NaN входы → строка помечается как недоступная, без падения.  
- **TC-SPR-04**: Порог отображения (threshold) применён.

### Matrix
- **TC-MAT-01**: Генерация матрицы биржа×биржа, диагональ = 0/—.  
- **TC-MAT-02**: Ховер/клик по ячейке → показывает детали пары.  
- **TC-MAT-03 (neg)**: Нет данных одной биржи → строка/столбец серый, UI не ломается.

### Favorites
- **TC-FAV-01**: Добавить в избранное (иконка звезды).  
- **TC-FAV-02**: Удалить из избранного.  
- **TC-FAV-03**: Перезагрузка страницы → список сохранён (локальное хранилище).  
- **TC-FAV-04 (neg)**: Попытка добавить дубликат → не создаёт вторую запись.

### WebSocket
- **TC-WS-01**: Подключение к `/ws?exchange=XYZ`, получение `snapshot`.  
- **TC-WS-02**: Получение `tick` → UI обновляется ≤ 200 мс.  
- **TC-WS-03**: Пинг приходит раз в N сек; без пингов — реконнект.  
- **TC-WS-04 (neg)**: Обрыв сети → восстановление ≤ 5 сек.  
- **TC-WS-05 (neg)**: Неверный `exchange` → корректное сообщение об ошибке/отказ в подключении.

### REST/Ошибки/Производительность
- **TC-ERR-01 (neg)**: 5xx от backend → UI показывает нотификацию, повторная попытка.  
- **TC-ERR-02 (neg)**: 429/rate limit → бэк-офф, без спама.  
- **TC-ERR-03 (neg)**: Пустой ответ/пустой список → пустое состояние без падения.  
- **TC-PERF-01**: Время загрузки начальной страницы ≤ 2.0 сек (prod build).  
- **TC-PERF-02**: Память вкладки браузера стабильна при стриме 10 минут (без роста >10%).

## Приложение C. Средства и команды
- Backend: `pytest -q`, `uvicorn app:app`.
- Frontend unit: `npm run test`.
- E2E: `npx playwright test`.
- Линт: `npm run lint`, типы: `npm run typecheck`.
